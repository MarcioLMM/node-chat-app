<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Chat | ChatApp</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="/css/reset.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="/css/materialize/css/materialize.min.css">
    <link rel="stylesheet" href="/css/chat.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
        crossorigin="anonymous">
</head>

<body class="container-body">
    <div class="container-conteudo" style="display: flex; flex-direction: column; height: 100%;">


        <nav style="min-height: 70px;position: absolute;">
            <ul id="slide-out" class="sidenav sidenav-fixed" style="overflow: hidden;">
                <li>
                    <div class="user-view">
                        <div class="background">
                            <img src="img/office.jpg" />
                        </div>
                        <div class="namePrincipal">{{nome}}</div>
                        <div>
                            <span class="nomeUsuarioLogado white-text">{{nome}}</span>
                        </div>
                        <div>
                            <span class="white-text email">{{email}}</span>
                        </div>
                    </div>
                    <div style="position: absolute;top: 20px;right: 20px;">
                        <a href="/logout" class="logout" title="Logout">
                            <i class="fas fa-sign-out-alt" style="height: 30px;width:30px;font-size: 30px;"></i>
                        </a>
                    </div>
                    <div style="position: absolute;top: 50px;right: 10px;">
                        <a href="#" data-target="slide-out3" class="sidenav-trigger waves-effect waves-teal" style="display: block;margin-left: 0px;padding: 0px;    background: unset;">
                            <i class="fas fa-cog" style="font-size: 2em" title="configurações"></i>
                        </a>
                    </div>
                </li>
                <li style="display: flex;">
                    Teste{{nomeDoCara}}
                </li>
                <li style="display: flex;    justify-content: center;">
                    <ul id="slide-out3" class="sidenav" style="color: #000;">
                        <li style="width: 100%; height: 100%;">
                            <div style="display: flex;flex-direction: column; height: 100%;width: 100%;">
                                <a style="background: unset;padding: 0px;margin-right: 10px;position: absolute;z-index: 1; left: 15px; top: 15px;" id="btn-voltar2"
                                    title="Voltar">
                                    <i style="padding: 0px; margin: 0px;font-size: 2em;height: 30px;color: rgba(0,0,0,0.54);" class="fas fa-arrow-left"></i>
                                </a>
                                <h4 style="    font-size: 20px; left: 23px;text-align: center;">
                                    configurações
                                </h4>

                                <div id="imagem-configuracoes">
                                    <div class="namePrincipal">{{nome}}</div>
                                </div>
                                <input id="fiAlterar-imagem" type="file" style="display: none;">

                                <div class="card">
                                    <div class="row valign-wrapper" style="margin-bottom: 0px;">
                                        <div class="col s10">
                                            <span class="nomeUsuarioLogado" style="width: 100%;padding-left: 5px;">{{nome}}</span>
                                        </div>
                                        <div class="col s3" style="display: flex;justify-content: flex-end;">
                                            <a style="cursor: pointer;background: unset;padding-right: 10px;" class="modal-trigger" href="#modalAlterarNome">
                                                <i style="height: 25px;color: rgba(0,0,0,0.54);" class="fas fa-pencil-alt" title="Editar"></i>
                                            </a>
                                            <a style="cursor: pointer;background: unset;padding-right: 10px;" class="modal-trigger" href="#modalExcluirConta">
                                                <i style="height: 25px;color: rgba(0,0,0,0.54);" class="fas fa-trash-alt" title="Remover"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </li>
                    </ul>
                </li>
                <li>
                    <ul id="usuariosLogados" class="container-lista-conversas"></ul>
                </li>
            </ul>
            <a href="#" data-target="slide-out" class="sidenav-trigger">
                <i class="material-icons">menu</i>
            </a>
            <div class="row right info-perfil-right">
                
            </div>
        </nav>
        <main class="main" style="padding-top: 70px;" id="mensagens">
            <section style="background: #efebe9 ; height: 100%; width: 100%;display: flex; flex-direction: column;">
                <main class="container-msg"> </main>
                {{#each mensagens}} {{{this}}} {{/each}}
                <footer class="grey lighten-2" style="width: 100%;">
                    <div class="div-menssagem">
                        <div class="container-Menssagem">
                            <textarea id="ctMenssagem" class="textarea-menssagem" placeholder="Digite uma menssagem"></textarea>
                        </div>
                        <div class="container-btnEviar">
                            <button id="btn-enviar" type="submit">
                                <i class="fa fa-paper-plane" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </footer>
            </section>
        </main>
    </div>

    <!-- Modal Structure -->
    <div id="modalAlterarNome" class="modal" style="width: 90%;max-width: 650px;    min-height: 200px;">
        <div class="modal-header" style="padding: 10px 10px 0px 10px;text-align: center;">
            <h4>Alterar nome</h4>
        </div>
        <div id="corpoModalAlterarNome" class="modal-content" style="padding-top: 0px;">
            <form>
                <div class="input-field" style="margin-bottom: 25px;">
                    <input id="ctNome" type="text" class="validate" required>
                    <label for="ctNome">Nome</label>
                </div>
            </form>
        </div>
        <div class="modal-footer" style="padding-left: 24px;padding-right: 24px;">
            <button onclick="enviaFormAlterarNome();" class="btn btn-login" type="button">Salvar</button>
            <button class="modal-action modal-close btn grey darken-1" type="button" style="float:left;">fechar</button>
        </div>
    </div>

    <!-- Modal Structure -->
    <div id="modalExcluirConta" class="modal" style="width: 90%;max-width: 315px;    min-height: 200px;">
        <div class="modal-header" style="padding: 10px 10px 0px 10px;text-align: center;">
            <h4>Excluir conta!</h4>
        </div>
         <div class="modal-content" style="padding-top: 0px;">
            <span>Tem certeza que deseja remover a conta?</span>
        </div>
        
        <div class="modal-footer" style="padding-left: 24px;padding-right: 24px;">
            <a href="/deletaUsuario/{{id}}" class="btn btn-login" title="remover">Sim</a>
            <button class="modal-action modal-close btn grey darken-1" type="button" style="float:left;">Não</button>
        </div>
    </div>
    <p id="userId" style="display: none">{{id}}</p>
    <p id="user_name" style="display: none">{{nome}}</p>
    <p id="idTo" style="display: none">{{idTo}}</p>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/libs/jquery-3.1.0.min.js"></script>
    <script src="/css/materialize/js/materialize.min.js"></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="/js/libs/moment.js"></script>
    <script src="/js/libs/deparam.js"></script>
    <script src="/js/chat.js"></script>



    <script>
        $(document).ready(function () {

            $('.namePrincipal').nameBadge(
                {
                    border: { width: 0 },
                    colors: ['#1abc9c'],
                    text: '#fff',
                    margin: 0,
                    size: 64,
                    uppercase: true
                });
                 



            $('#modalExcluirConta').modal();
            $('#modalAlterarNome').modal();
            $('#slide-out').sidenav();
            
            var elem2 = $('#slide-out3').sidenav();
            var instance2 = M.Sidenav.getInstance(elem2);
            $("#btn-voltar2").click(function () {
                instance2.close();
            });
            $(".div-hover").click(function () {
                console.log("passei");
                $("#fiAlterar-imagem").click();
            });
            $(".container-msg").animate({ scrollTop: $('.container-msg').prop("scrollHeight") }, 0);
            $("#ctMenssagem").keydown(function (e) {
                var elemento = this;
                var teclaPressionada = e.which || e.keyCode;
                var ENTER = 13;
                if ($(elemento).val() == '' && teclaPressionada == ENTER && e.shiftKey == false) {
                    return false;
                }
                else {
                    setTimeout(function () {
                        if ($(elemento).length === 0 || !$(elemento).val().trim()) {
                            $(elemento).val('');
                            $(elemento).css("height", "22px");
                            return false;
                        }
                        $(elemento).css({ "min-height": "22px", "height": "auto", "padding": "0" });
                        $(elemento).css("height", $(elemento).prop('scrollHeight') + "px");
                        if ($(elemento).val() == '') {
                            $(elemento).css("height", "22px");
                        }
                        if ($(elemento).val() != '' && teclaPressionada == ENTER && e.shiftKey == false) {
                            $("#btn-enviar").click();
                        }
                    }, 0);
                }
            });

        });
        function selectUser(elemento) {
            $('#nome-perfil-right').remove();
            $('#imagem-perfil-right').remove();
            var nome = $(elemento).find('span').text();
            var usuarioSelect = "<span id='nome-perfil-right' style='margin: -6px;margin-right: 10px;'>" + nome + "</span>" +
                "<img  id='imagem-perfil-right' style='height: 50px; margin-right: 23px;' src='/img/me.jpg' class='circle responsive-img' /> "

            $('.info-perfil-right').append(usuarioSelect); console.log("entrei");

        }

    </script>
</body>

</html>